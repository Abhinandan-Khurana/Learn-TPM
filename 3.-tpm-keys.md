---
description: About TPM key generation, key management and hierarchies
---

# 3. TPM keys

A Trusted Platform Module (TPM) is a specialized chip on an endpoint device that stores RSA encryption keys specific to the host system for hardware authentication. The TPM technology is designed to provide hardware-based, security-related functions.

### How TPM internally works (based on cryptographic keys)

As a TPM can securely generate encryption keys, it has the following architecture -

SEED - This is usually setted-up by the manufacturer, which plays a vital role in generating the primary/private key data inside the KDF (key derivation function) which also adds additional entropy to the KDF.

By using the same user entropy added to the internal seed we can know who generated the same primary key.&#x20;

PRIMARY KEY -&#x20;

* Primary Keys are generated by the TPM and never leave the TPM. They are used to protect (encrypt) child keys.&#x20;
* The Primary Key is at the root of the TPM's storage hierarchy. It's created when you take ownership of the TPM and it is protected by the **Storage Root Key (SEED)**, which is burned into the TPM at manufacture time.
* The private portion of a primary key, also called an endorsement key, is never exposed to any other component, software, process, or user.
* As the private material of private keys never leave the TPM, we can only regenerate them.\
  We can also persist a TPM key to aviod the regeneration of the keys.

CHILD KEYS -&#x20;

* Child keys can leave the TPM if they are encrypted by a parent key (also known as wrapping). This means that the child key is protected by the parent key.&#x20;
* A child key is a key that is created by a TPM and wrapped (encrypted) by its parent key.&#x20;
* A child key can be used for various purposes, such as signing, encryption, or storage.&#x20;
* A child key can also become a parent key if it meets certain conditions, such as being a storage key.&#x20;
* A child key can only be unwrapped (decrypted) by its parent key.

> Here is an example to make it clearer:
>
> Let's say you have a safe (the TPM) and inside that safe, you have a locked box (primary key). Inside this locked box, you place another smaller locked box (child key). The smaller box can be taken out of the safe, but it can't be opened because it's protected by the lock from the bigger box (encrypted by the parent key). The big box can't be taken out of the safe (never leaves the TPM).
>
> So, the big box (primary key) protects the smaller box (child key), and the safe (TPM) protects the big box. This process ensures a secure way of handling keys, where even if the child key is somehow exposed, it can't be used because it's encrypted by the primary key.

The TPM can create a hierarchy of keys, where each level of keys is protected by the level above it. This provides security and flexibility for key management. For example, a primary key can be used to create a storage key, which can be used to create signing keys, which can be used to sign data or certificates. The TPM can also seal and unseal keys based on the state of the system, ensuring that the keys are only accessible when the system is trustworthy.

### TPM key hierarchies -

<figure><img src=".gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

